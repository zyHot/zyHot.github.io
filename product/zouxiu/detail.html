<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <!-- SEO  -->
    <meta name="keywords" content=""/>
    <meta name="description" content=""/>
    <meta name="author" content=""/>
    <!-- 苹果专用 -->
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="blank"/>
    <meta name="format-detection" content="telephone=no"/>
    <!-- 简单移动端适配 -->
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
    <!-- 图标 -->
    <link rel="shortcut icon" href="">
    <title>首页</title>
    <link rel="stylesheet" href="css/public.css">
    <link rel="stylesheet" href="css/detail.css">
    <link rel="stylesheet" type="text/css" href="css/swiper-3.3.1.min.css"/>
    <link rel="stylesheet" href="iconfont/iconfont.css">
</head>
<body>
<header>
    <div class="headerTop">
        <div class="left">
            <a href="javascript:history.go(-1)">
                <img src="img/left.jpg" alt="">
            </a>
        </div>
        <div class="center">
            <b>商品介绍</b>
        </div>
        <div class="right">
            <a href="register.html">分享</a>
        </div>
    </div>
</header>
<div class="detailSwiper">
    <div class="swiper-container swiper-container-out">
        <div class="swiper-wrapper">
            <div class="swiper-slide">
                <div class="introduce">
                    <img src="" alt="">
                    <h3 class="goodName"><b></b><span >￥<strong></strong></span></h3>
                    <p>市场价 ：
                        <del>￥<span class="price"></span></del>
                        <span class="discount"></span>折
                        <span class="buyName"><b></b>人购买</span>
                    </p>
                </div>
            </div>
            <div class="swiper-slide">
                <div class="detailDiv">
                    <img src="" alt="">
                </div>
            </div>
            <div class="swiper-slide">
                <div class="swiper-container swiper-container-in">
                    <div class="swiper-wrapper">
                        <div class="swiper-slide"><img src="" alt=""></div>
                        <div class="swiper-slide"><img src="" alt=""></div>
                        <div class="swiper-slide"><img src="" alt=""></div>
                        <div class="swiper-slide"><img src="" alt=""></div>
                    </div>
                    <div class="swiper-pagination"></div>
                </div>
            </div>
        </div>
        <div class="swiper-pagination swiper-pagination-out"></div>
    </div>
</div>
<script src="js/jquery-1.12.1.js" type="text/javascript"></script>
<script src="js/swiper-3.3.1.jquery.min.js" type="text/javascript" charset="utf-8"></script>
<script src="js/app.js"></script>
<script>
    $(function () {
        var swiperOut = new Swiper('.swiper-container-out', {
            pagination: '.swiper-pagination',
            paginationClickable: true,
            noSwiping : true,
            paginationBulletRender: function (index, className) {
                var span = ['<div class="span"><div class="name">介绍</div></div>',
                    '<div class="span"><div class="name">详情</div></div>',
                    '<div class="span"><div class="name">实拍</div></div>'];
                return '<span class="btn ' + className + '">' + span[index] + '</span>';
            },
            onSlideChangeEnd: function(swiper){
            	if(swiper.activeIndex  == 2){
//          		$('.swiper-container-out .swiper-slide').eq(2).addClass("swiper-no-swiping")
            	}
                if(swiper.activeIndex == 0){
                    $(".center b").html("商品介绍");
                }else {
                    $(".center b").html("商品详情");
                }
            }
        });
        var swiperIn = new Swiper('.swiper-container-in', {
            pagination: '.swiper-pagination',
            paginationClickable: true,
            onSlideChangeEnd:function(swiper){
            	console.log(swiper.activeIndex);
            	if(swiper.activeIndex == 0){
            		swiperIn.lockSwipeToPrev();
            	}
            }
        });
        var goodsID = parseUrl()["goodsID"];
        getGoodDetail();
        function getGoodDetail(){
            $.ajax({
                type:"get",
                url:"http://datainfo.duapp.com/shopdata/getGoods.php",
                data:{
                    goodsID:goodsID
                },
                dataType:"JSONP",
                success:function(data){
                    console.log(data);
                    goodIntroduce(data[0]);
                    var str = data[0].imgsUrl;
                    var json = JSON.parse(str);
                    console.log(json[0]);
                    $(".detailDiv img").prop("src",json[0]);
                    var splitTxt = data[0].detail;
                    var arr = splitTxt.split("。");
                    for(var i=0;i<arr.length;i++){
                        var pTag = '<p>'+ arr[i] +'</p>';
                        $(".detailDiv").append(pTag);
                    }

                    var getImg = data[0].goodsBenUrl;
                    getImg = JSON.parse(getImg);
                    for(var j=0;j<getImg.length;j++){
                        $(".swiper-container-in img").eq(j).prop("src",getImg[j]);
                    }
                },
                error:function(XMLHttpRequest,textStatus,errorThrown){
                    console.log("errorThrown:"+errorThrown);
                }
            });
        }
        function parseUrl(){
            var url = location.href;
            var i=url.indexOf('?');
            if(i==-1)return;
            var querystr=url.substr(i+1);
            var arr1=querystr.split('&');
            var arr2=new Object();
            for  (i in arr1){
                var ta=arr1[i].split('=');
                arr2[ta[0]]=ta[1];
            }
            return arr2;
        }
        function goodIntroduce(data){
            $(".introduce img").prop("src",data.goodsListImg);
            $(".goodName b").html(data.goodsName);
            $(".goodName strong").html(data.price);
            $(".discount").html(data.discount);
            $(".buyName b").html(data.buynumber);
            var price ="";
            if(data.discount == 0){
                price = data.price
            }else {
                price = parseInt(10*data.price/data.discount);
            }
            $(".price").html(price);
        }
    });
</script>
</body>
</html>
